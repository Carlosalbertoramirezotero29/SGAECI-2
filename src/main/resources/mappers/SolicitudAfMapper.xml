<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
 
<mapper namespace='edu.eci.pdsw.samples.persistence.mybatisimpl.mappers.SolicitudAfMapper'>
    <resultMap type='SolicitudAfiliacion' id='SolicitudResult'>
        <id property='solicitudID' column='SolicitudID'/>
        <result property='fechaSolicitud' column='Fecha_Solicitud'/>
        <result property='estadoSolicitud' column='Estado_Solicitud'/>
        <result property='comentario' column='Comentario'/>
        <association property='e1' javaType='Egresado' resultMap='EgresadoResult' columnPrefix='Egre_'></association>
        <association property='e2' javaType='Estudiante' resultMap='EstudianteResult' columnPrefix='Estu_'></association>  
    </resultMap>
   
    <resultMap type='Estudiante' id='EstudianteResult'>
        <id property='documentoID' column='DocumentoID'/>
        <result property='telefono1' column='Telefono1'/>
        <result property='telefono2' column='Telefono2'/>  
        <result property='tipoDocumentoID' column='TipoDocumentoID'/> 
        <result property='nombre' column='Nombre'/> 
        <result property='direccion' column='Direccion'/> 
        <result property='correo' column='Correo'/> 
        <result property='genero' column='Genero'/> 
        <result property='codigoEstudiante' column='Codigo_Estudiante'/> 
        <result property='semestrePonderado' column='Semestre_Ponderado'/> 
        <result property='carrera' column='Carrera'/> 
    </resultMap>
    
    <resultMap type='Egresado' id='EgresadoResult'>
        <id property='documentoID' column='DocumentoID'/>
        <result property='telefono1' column='Telefono1'/>
        <result property='telefono2' column='Telefono2'/>  
        <result property='tipoDocumentoID' column='TipoDocumentoID'/> 
        <result property='nombre' column='Nombre'/> 
        <result property='direccion' column='Direccion'/> 
        <result property='correo' column='Correo'/> 
        <result property='genero' column='Genero'/> 
        <result property='semestreGrado' column='Semestre_Graduacion'/> 
        <result property='correoPersonal' column='Correo_Personal'/> 
        <result property='cargo' column='Cargo'/> 
        <result property='labora' column='Labora'/> 
        <association property='emp' javaType='Egresado_Empresa' resultMap='EmpresaResult' columnPrefix='Epre_'></association>
    </resultMap>

    <resultMap type='Egresado_Empresa' id='EmpresaResult'>
        <id property='empresaid' column='EmpresaID'/>
        <result property='nombreempre' column='Nombre'/>
        <result property='telempre' column='Telefono'/>   
        <result property='dirempre' column='Direccion'/>
        
    </resultMap>
    
    <select parameterType='map' id='getSolicitudesAfiliacion' resultMap='SolicitudResult'  >   
        SELECT so.SolicitudID,
        so.Fecha_Solicitud, 
        so.Estado_Solicitud, 
        so.Comentario,
        
        p1.DocumentoID as Egre_DocumentoID,
        p1.Telefono1 as Egre_Telefono1,
        p1.Telefono2 as Egre_Telefono2,
        p1.TipoDocumentoID as Egre_TipoDocumentoID,
        p1.Nombre as Egre_Nombre,
        p1.Direccion as Egre_Direccion,
        p1.Correo as Egre_Correo,
        p1.Genero as Egre_Genero,
        Egresado.Semestre_Graduacion as Egre_Semestre_Graduacion, 
        Egresado.Correo_Personal as Egre_Correo_Personal, 
        Egresado.Cargo as Egre_Cargo,
        Egresado.Labora as Egre_Labora, 
        
        Egresado_Empresa.EmpresaID as Egre_Epre_EmpresaID, 
        Egresado_Empresa.Nombre as Egre_Epre_Nombre, 
        Egresado_Empresa.Telefono as Egre_Epre_Telefono, 
        Egresado_Empresa.Direccion as Egre_Epre_Direccion,
        
        p1.DocumentoID as Estu_DocumentoID,
        p1.Telefono1 as Estu_Telefono1,
        p1.Telefono2 as Estu_Telefono2,
        p1.TipoDocumentoID as Estu_TipoDocumentoID,
        p1.Nombre as Estu_Nombre,
        p1.Direccion as Estu_Direccion,
        p1.Correo as Estu_Correo,
        p1.Genero as Estu_Genero, 
        Estudiante.Codigo_Estudiante as Estu_Codigo_Estudiante,
        Estudiante.Semestre_Ponderado as Estu_Semestre_Ponderado, 
        Estudiante.Carrera as Estu_Carrera  
         
        FROM Persona as p1 INNER JOIN Solicitud_Afiliacion as so ON(p1.DocumentoID = so.DocumentoID) LEFT JOIN Estudiante ON (Estudiante.DocumentoID = p1.DocumentoID) LEFT JOIN Egresado ON (Egresado.DocumentoID= p1.DocumentoID) LEFT JOIN Egresado_Empresa ON (Egresado.EmpresaID = Egresado_Empresa.EmpresaID)   
        
    </select>
    
    <select id='getSolicitudAf' parameterType='map' resultMap='SolicitudResult' >   
        SELECT SolicitudID,
        Fecha_Solicitud,
        Estado_Solicitud,
        Comentario,
        p1.DocumentoID as Estu_DocumentoID,
        p1.Telefono1 as Estu_Telefono1,
        p1.Telefono2 as Estu_Telefono2,
        p1.TipoDocumentoID as Estu_TipoDocumentoID,
        p1.Nombre as Estu_Nombre,
        p1.Direccion as Estu_Direccion,
        p1.Correo as Estu_Correo,
        p1.Genero as Estu_Genero, 
        Estudiante.Carrera as Estu_Carrera, 
        Estudiante.Semestre_Ponderado as Estu_Semestre_Ponderado, 
        Estudiante.Codigo_Estudiante as Estu_Codigo_Estudiante,
        
        p1.DocumentoID as Egre_DocumentoID,
        p1.Telefono1 as Egre_Telefono1,
        p1.Telefono2 as Egre_Telefono2,
        p1.TipoDocumentoID as Egre_TipoDocumentoID,
        p1.Nombre as Egre_Nombre,
        p1.Direccion as Egre_Direccion,p1.Correo as Egre_Correo,
        p1.Genero as Egre_Genero,
        Egresado.Semestre_Graduacion as Egre_Semestre_Graduacion, 
        Egresado.Correo_Personal as Egre_Correo_Personal, 
        Egresado.Labora as Egre_Labora, 
        Egresado.Cargo as Egre_Cargo,
        
        Egresado_Empresa.EmpresaID as Egre_Epre_EmpresaID, 
        Egresado_Empresa.Nombre as Egre_Epre_Nombre, 
        Egresado_Empresa.Telefono as Egre_Epre_Telefono, 
        Egresado_Empresa.Direccion as Egre_Epre_Direccion 
        
        FROM Persona as p1 INNER JOIN Solicitud_Afiliacion ON(p1.DocumentoID = Solicitud_Afiliacion.DocumentoID) LEFT JOIN Estudiante ON (Estudiante.DocumentoID = p1.DocumentoID) LEFT JOIN Egresado ON (Egresado.DocumentoID= p1.DocumentoID) LEFT JOIN Egresado_Empresa ON (Egresado.EmpresaID = Egresado_Empresa.EmpresaID)
        WHERE Solicitud_Afiliacion.DocumentoID=#{identificador}
        
    </select>
     
    <insert id='insertarPersona' parameterType="map" >
        INSERT INTO Persona(DocumentoID,TipoDocumentoID,Nombre,Direccion,Correo,Genero,Telefono1,Telefono2) values (#{documentoID},#{tipoDocumentoID},#{nombre},#{direccion},#{correo},#{genero},#{telefono1},#{telefono2})
    </insert>
    
    <delete id="eliminarPersona" parameterType="map" >
        DELETE FROM Persona WHERE(DocumentoID=#{documentoID})
    </delete>
    
    <insert id='insertarSolicitudAfiliacion' parameterType='map' >
        INSERT INTO Solicitud_Afiliacion (DocumentoID,Fecha_Solicitud,Estado_Solicitud,Comentario) values(#{documentoid},#{fecha},#{estado},#{comentario})
    </insert>
    
    <delete id="eliminarSolicitud" parameterType="map" >
        DELETE FROM Solicitud_Afiliacion WHERE(DocumentoID=#{documentoID})
    </delete>
    
</mapper>
